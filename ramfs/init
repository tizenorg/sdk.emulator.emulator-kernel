#!/bin/busybox sh
# SeokYeon Hwang (syeon.hwang@samsung.com)

COLOR_BLUE="\033[1;34m" # light blue
COLOR_GREEN="\033[1;32m" # light green
COLOR_RED="\033[1;31m" # light red
NO_COLOR="\033[0m"

NEW_ROOT="/new_root"

/bin/busybox mkdir -p /dev
/bin/busybox mount -t devtmpfs devtmpfs /dev

exec &> /dev/console

# for debugging...
#/bin/busybox ls -la /dev >> /dev/console

echo -e "${COLOR_GREEN}Preparing...${NO_COLOR}"
/bin/busybox mkdir -p /proc
/bin/busybox mount -t proc proc /proc
/bin/busybox mkdir -p /sys
/bin/busybox mount -t sysfs sys /sys

# mount root...
echo -e "${COLOR_GREEN}Mount image...${NO_COLOR}"
/bin/busybox mount -o rw /dev/vda $NEW_ROOT

# clean up...
/bin/busybox umount /proc
/bin/busybox umount /sys

# switch root...
echo -e "${COLOR_GREEN}Switching root...${NO_COLOR}"
exec /bin/busybox switch_root -c /dev/console $NEW_ROOT /sbin/init
